<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>HTORI ERP - Clean Start</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
    body { margin:0; background:#f4f6f8; }

    header {
      height:50px; background:#1F3C88; color:#fff;
      display:flex; align-items:center; padding:0 16px;
      font-weight:bold;
    }

    .layout { display:flex; height:calc(100vh - 50px); }

    aside {
      width:200px; background:#111; color:#fff;
      padding:10px;
    }

    aside button {
      width:100%; margin-bottom:6px; padding:8px;
      background:#222; color:#fff; border:0;
      text-align:left; cursor:pointer;
    }

    aside button:hover { background:#333; }

    main {
      flex:1; padding:16px; background:#fff;
      overflow:auto;
    }

    h1 { margin-top:0; font-size:22px; }

    .row { display:flex; gap:8px; margin-bottom:8px; }
    input, select, button {
      padding:6px; font-size:14px;
    }

    table {
      width:100%; border-collapse:collapse; margin-top:10px;
    }
    th, td {
      border:1px solid #ccc; padding:6px; text-align:left;
      font-size:14px;
    }

    .login {
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.3);
    }

    .login-box {
      background:#fff; padding:20px; width:300px;
      border-radius:6px;
    }
  </style>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>

<header>HTORI ERP (CLEAN START)</header>

<div class="layout">
  <aside>
    <button onclick="showPage('purchase')">Purchase</button>
    <button onclick="logout()">Logout</button>
  </aside>

  <main id="content"></main>
</div>

<!-- LOGIN -->
<div id="login" class="login">
  <div class="login-box">
    <h3>Login</h3>
    <input id="loginId" placeholder="admin"><br><br>
    <input id="loginPw" type="password" placeholder="1234"><br><br>
    <button onclick="login()">Login</button>
  </div>
</div>

<script>
/* ===============================
   Firebase Config
================================ */
firebase.initializeApp({
  apiKey: "AIzaSyDwiTlPtoXraEtA7TzTctdH6DJS6gdSEGQ",
  databaseURL: "https://htori-erp-3c22b-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = firebase.database();

/* ===============================
   LOGIN
================================ */
function login(){
  const id = loginId.value;
  const pw = loginPw.value;
  if(id==="admin" && pw==="1234"){
    localStorage.setItem("login","1");
    document.getElementById("login").style.display="none";
    showPage("purchase");
  } else {
    alert("login fail");
  }
}

function logout(){
  localStorage.removeItem("login");
  location.reload();
}

if(localStorage.getItem("login")==="1"){
  document.getElementById("login").style.display="none";
  showPage("purchase");
}

/* ===============================
   PAGE SWITCH
================================ */
function showPage(page){
  if(page==="purchase") renderPurchase();
}

/* ===============================
   PURCHASE (입고)
================================ */
function renderPurchase(){
  content.innerHTML = `
    <h1>Purchase</h1>

    <div class="row">
      <input type="date" id="p_date">
      <select id="p_type">
        <option value="Container">Container</option>
        <option value="Air">Air</option>
      </select>
      <input id="p_code" placeholder="Code">
      <input id="p_name" placeholder="Name">
      <input id="p_qty" type="number" placeholder="Qty">
      <button onclick="addPurchase()">Add</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Date</th><th>Type</th><th>Code</th><th>Name</th><th>Qty</th>
        </tr>
      </thead>
      <tbody id="p_list"></tbody>
    </table>
  `;

  p_date.value = new Date().toISOString().split("T")[0];
  loadPurchase();
}

function addPurchase(){
  const data = {
    date: p_date.value,
    type: p_type.value,
    code: p_code.value,
    name: p_name.value,
    qty: Number(p_qty.value)
  };
  if(!data.code || !data.qty) return alert("Code & Qty");

  db.ref("purchase").push(data).then(loadPurchase);
  p_code.value=""; p_name.value=""; p_qty.value="";
}

function loadPurchase(){
  p_list.innerHTML="";
  db.ref("purchase").once("value").then(s=>{
    Object.values(s.val()||{}).forEach(r=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${r.date}</td>
        <td>${r.type}</td>
        <td>${r.code}</td>
        <td>${r.name||""}</td>
        <td>${r.qty}</td>
      `;
      p_list.appendChild(tr);
    });
  });
}
</script>

</body>
</html>
