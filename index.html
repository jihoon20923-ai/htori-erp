<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>HTORI ERP</title>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

/* LOGIN */
#loginBox {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.login-card {
  border: 1px solid #ccc;
  padding: 30px;
  width: 360px;
  text-align: center;
}

.login-card input {
  width: 100%;
  padding: 6px;
  margin-bottom: 10px;
}

/* ERP */
#erp {
  display: none;
}

.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 180px;
  height: 100vh;
  background: #222;
  color: #fff;
}

.sidebar div {
  padding: 14px;
  cursor: pointer;
}

.sidebar div:hover {
  background: #444;
}

.content {
  margin-left: 180px;
  padding: 20px;
}

/* COMMON */
h1, h2 {
  font-size: 22px;
}

input, button {
  font-size: 14px;
  padding: 4px 6px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 14px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

button.small {
  font-size: 12px;
  padding: 2px 6px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <div class="login-card">
    <h2>HTORI ERP LOGIN</h2>
    <input id="loginId" placeholder="admin">
    <input id="loginPw" type="password" placeholder="1234">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- ERP -->
<div id="erp">
  <div class="sidebar">
    <div onclick="loadPage('dashboard')">Dashboard</div>
    <div onclick="loadPage('stock')">Stock</div>
    <div onclick="loadPage('purchase')">Purchase</div>
    <div onclick="logout()">Logout</div>
  </div>

  <div class="content" id="content"></div>
</div>

<script>
/* ===== LOGIN ===== */
function login() {
  if (loginId.value === "admin" && loginPw.value === "1234") {
    localStorage.setItem("htori_login", "Y");
    loginBox.style.display = "none";
    erp.style.display = "block";
    loadPage("dashboard");
  } else {
    alert("Login failed");
  }
}

function logout() {
  localStorage.removeItem("htori_login");
  erp.style.display = "none";
  loginBox.style.display = "flex";
}

window.onload = function () {
  if (localStorage.getItem("htori_login") === "Y") {
    loginBox.style.display = "none";
    erp.style.display = "block";
    loadPage("dashboard");
  }
};

/* ===== STORAGE ===== */
function getStock() {
  return JSON.parse(localStorage.getItem("htori_stock") || "[]");
}

function saveStock(data) {
  localStorage.setItem("htori_stock", JSON.stringify(data));
}

function getPurchase() {
  return JSON.parse(localStorage.getItem("htori_purchase") || "[]");
}

function savePurchase(data) {
  localStorage.setItem("htori_purchase", JSON.stringify(data));
}

/* ===== PAGE ===== */
function loadPage(page) {
  if (page === "dashboard") {
    content.innerHTML = `<h1>Dashboard</h1>`;
  }

  if (page === "stock") {
    content.innerHTML = `
      <h2>Stock</h2>

      <input id="sCode" placeholder="Code">
      <input id="sName" placeholder="Name">
      <input id="sQty" type="number" placeholder="Qty">
      <button onclick="addStock()">Add</button>

      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Qty</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="stockBody"></tbody>
      </table>
    `;
    loadStock();
  }

  if (page === "purchase") {
    content.innerHTML = `
      <h2>Purchase (Inbound)</h2>

      <input id="pCode" placeholder="Code">
      <input id="pName" placeholder="Name">
      <input id="pQty" type="number" placeholder="Qty">
      <button onclick="addPurchase()">Receive</button>

      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Qty</th>
          </tr>
        </thead>
        <tbody id="purchaseBody"></tbody>
      </table>
    `;
    loadPurchase();
  }
}

/* ===== STOCK ===== */
function loadStock() {
  const data = getStock();
  stockBody.innerHTML = "";
  data.forEach((item, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.code}</td>
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>
        <button class="small" onclick="editStock(${index})">Edit</button>
        <button class="small" onclick="deleteStock(${index})">Del</button>
      </td>
    `;
    stockBody.appendChild(tr);
  });
}

function addStock() {
  const code = sCode.value.trim();
  const name = sName.value.trim();
  const qty = Number(sQty.value);

  if (!code || !name || !qty) return alert("Fill all fields");

  const data = getStock();
  const found = data.find(i => i.code === code);

  if (found) found.qty += qty;
  else data.push({ code, name, qty });

  saveStock(data);
  loadStock();

  sCode.value = sName.value = sQty.value = "";
}

function editStock(index) {
  const data = getStock();
  const item = data[index];
  sCode.value = item.code;
  sName.value = item.name;
  sQty.value = item.qty;
  data.splice(index, 1);
  saveStock(data);
  loadStock();
}

function deleteStock(index) {
  if (!confirm("Delete?")) return;
  const data = getStock();
  data.splice(index, 1);
  saveStock(data);
  loadStock();
}

/* ===== PURCHASE ===== */
function loadPurchase() {
  const data = getPurchase();
  purchaseBody.innerHTML = "";
  data.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.code}</td>
      <td>${item.name}</td>
      <td>${item.qty}</td>
    `;
    purchaseBody.appendChild(tr);
  });
}

function addPurchase() {
  const code = pCode.value.trim();
  const name = pName.value.trim();
  const qty = Number(pQty.value);

  if (!code || !name || !qty) return alert("Fill all fields");

  /* Purchase log */
  const pData = getPurchase();
  pData.push({ code, name, qty });
  savePurchase(pData);
  loadPurchase();

  /* Stock increase */
  const sData = getStock();
  const found = sData.find(i => i.code === code);

  if (found) found.qty += qty;
  else sData.push({ code, name, qty });

  saveStock(sData);

  pCode.value = pName.value = pQty.value = "";
}
</script>

</body>
</html>
