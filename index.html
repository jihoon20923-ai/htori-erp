<script>
function savePurchase(){

  const date = document.getElementById("p_date").value;
  const code = document.getElementById("p_code").value.trim();
  const name = document.getElementById("p_name").value.trim();
  const qty  = Number(document.getElementById("p_qty").value);

  if(!code || !qty){
    alert("Code / Qty required");
    return;
  }

  /* 1️⃣ 입고 기록 저장 */
  db.ref("purchase").push({
    date: date,
    code: code,
    name: name,
    qty: qty
  });

  /* 2️⃣ 재고 누적 */
  const stockRef = db.ref("stock/" + code);

  stockRef.once("value").then(snapshot=>{
    let currentQty = 0;

    if(snapshot.exists()){
      currentQty = Number(snapshot.val().qty);
    }

    stockRef.set({
      code: code,
      name: name,
      qty: currentQty + qty
    });
  });

  alert("Saved");
  showStock();
}
</script>
